knitr::opts_chunk$set(echo = TRUE)
################################################################################
# I like to include several additional notes in the header of my files here:
#
# Last modified: 8/11/2022
#
### PURPOSE:
# Lecture 3 code and output file
#
### NOTES:
# - uses the Tidyverse package and Dplyr
################################################################################
### 0. Load the packages we will need for this file ####
library(tidyverse) # load the installed package for each new session of R
library(broom)
library(faux) # Useful package for simulating data
library(modelsummary) # For making regression tables
library(causaldata) # Useful toy data sets
library(here) # Helpful in working with directories and projects
set.seed(03262020) # Setting the seed helps to make random number generators give us the same numbers across machines
################################################################################
mydata <- causaldata::close_college
# First pass: simple regression
m1 <- lm(lwage ~ educ + exper, data=mydata)
msummary(list(m1),
stars=c('*' = .1, '**' = .05, '***' = .01))
head(mydata)
# First pass: simple regression in levels
mydata <- mydata %>% mutate(wage = exp(lwage))
head(mydata)
m_levels <- lm(wage ~ educ + exper, data=mydata)
msummary(list("levels"=m_levels, "log_y"=m1),
stars=c('*' = .1, '**' = .05, '***' = .01))
# How does the effect of education differ across race?
m2 <- lm(lwage ~ educ + exper + black + educ:black, data=mydata)
msummary(list(m1,m2),
stars=c('*' = .1, '**' = .05, '***' = .01))
ggplot(data=mydata,aes(x=exper,y=lwage)) + geom_point() +
theme_minimal() + labs(x="Experience (Years)",y="Wages") +
geom_smooth(method='lm', formula= y~x)
# What if we add in a squared term?
ggplot(data=mydata,aes(x=exper,y=lwage)) + geom_point() +
theme_minimal() + labs(x="Experience (Years)",y="Wages") +
stat_smooth(method="lm", se=TRUE, fill=NA,
formula=y ~ poly(x, 2, raw=TRUE),colour="red")
# What about a cubic term?
ggplot(data=mydata,aes(x=exper,y=lwage)) + geom_point() +
theme_minimal() + labs(x="Experience (Years)",y="Wages") +
stat_smooth(method="lm", se=TRUE, fill=NA,
formula=y ~ poly(x, 3, raw=TRUE),colour="red")
# Higher order terms?
n <- 10 # You pick a polynomial
ggplot(data=mydata,aes(x=exper,y=lwage)) + geom_point() +
theme_minimal() + labs(x="Experience (Years)",y="Wages") +
stat_smooth(method="lm", se=TRUE, fill=NA,
formula=y ~ poly(x, n, raw=TRUE),colour="red")
mydata <- mydata %>% mutate(wage=exp(lwage))
ggplot(mydata,aes(x=educ,y=wage)) + geom_point() + theme_minimal()
m1 <- lm(lwage ~ educ + exper + black + married + nearc4 + educ:black + exper:black, data=mydata)
msummary(list("naive"=m1),
stars=c('*' = .1, '**' = .05, '***' = .01))
# Same model with robust standard errors
msummary(list("naive"=m1,"robust"=m1),
vcov=c("classical","robust"),
stars=c('*' = .1, '**' = .05, '***' = .01))
mydata$state <- unlist(causaldata::abortion[1:3010,1])
m1 <- lm(lwage ~ educ + exper + black + married + nearc4 + educ:black + exper:black, data=mydata)
msummary(list("naive"=m1,"robust"=m1,"Clustered"=m1),
vcov=c("classical","robust",~state),
stars=c('*' = .1, '**' = .05, '***' = .01))
load("C:/Users/alexh/Dropbox/IBNR_MoralHazard_Github/2_Data/Model/AllYears_Complete_2022-09-23.Rdata")
head(mydata_t)
# Question: What is the effect of education on wages?
mydata <- causaldata::close_college
oddsplot(nearc4, educ)
install.packages('oddsplot')
install.packages('OddsPlotty')
library(OddsPlotty)
library(mlbench)
library(caret)
lirary(tibble)
library(tibble)
library(ggplot2)
library(e1071)
library(ggthemes)
data("BreastCancer", package = "mlbench")
#Use complete cases of breast cancer
breast <- BreastCancer[complete.cases(BreastCancer), ] #Create a copy
breast <- breast[, -1]
head(breast, 10)
#Convert the class to a factor - Beningn (0) and Malignant (1)
breast$Class <- factor(breast$Class)
str(breast)
for(i in 1:9) {
breast[, i] <- as.numeric(as.character(breast[, i]))
}
#Loops through the first columns - 1 to 9 and changes them from factors to a numerical representation
str(breast)
library(caret)
glm_model <- caret::train(Class ~ .,
data = breast,
method = "glm",
family = "binomial")
summary(glm_model)
plotty <- OddsPlotty::odds_plot(glm_model$finalModel,
title = "Odds Plot",
subtitle = "Showing odds of cancer based on various factors")
plotty$odds_plot
plotty$odds_data
tidy_odds_plot <- OddsPlotty::odds_plot(fitted_logistic_model$fit,
title="TidyModels Odds Plot",
point_col = "#6b95ff",
h_line_color = "red")
